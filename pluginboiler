private static void SetEmailRegardingCaseAndRelatedIntake(
    IOrganizationService service,
    Guid emailId,
    EntityReference caseRef,
    EntityReference intakeRef)
{
    var emailUpdate = new Entity("email", emailId);

    // regarding -> case
    emailUpdate["regardingobjectid"] = caseRef;

    // related partylist -> intake (overwrite whole list)
    var ap = new Entity("activityparty");
    ap["partyid"] = intakeRef;

    var related = new EntityCollection();
    related.EntityName = "activityparty";
    related.Entities.Add(ap);

    emailUpdate["related"] = related;

    service.Update(emailUpdate);
}


private static void RevertEmailRegardingIntakeAndClearRelated(
    IOrganizationService service,
    Guid emailId,
    EntityReference intakeRef)
{
    var emailUpdate = new Entity("email", emailId);

    // regarding -> intake
    emailUpdate["regardingobjectid"] = intakeRef;

    // clear partylist
    emailUpdate["related"] = null;

    service.Update(emailUpdate);
}
