function blobToFile(blob: Blob, fileName: string, mimeType?: string): File {
  return new File([blob], fileName, { type: mimeType ?? blob.type ?? "application/octet-stream" });
}


function filesToFileList(files: File[]): FileList {
  const dt = new DataTransfer();
  files.forEach((f) => dt.items.add(f));
  return dt.files;
}

const handleUploadSelectedFromSharePoint = async () => {
  if (!token || !spLocation) return;

  // selectedDriveItems: the files user checked in the dialog
  const blobs = await Promise.all(
    selectedDriveItems.map(async (item) => {
      const blob = await downloadViaDownloadUrl({ token, driveId, itemId: item.id }); // you already have this working
      const file = blobToFile(blob, item.name, item.file?.mimeType);
      return file;
    })
  );

  const fileList = filesToFileList(blobs);

  await uploadMutation.mutateAsync({ emailId, files: fileList }); // or however your hook signature is
};
